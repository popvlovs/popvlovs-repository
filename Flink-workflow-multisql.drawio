<mxfile host="www.draw.io" modified="2019-12-16T04:42:25.549Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36" etag="zAeOWgJn7lN_5qKth6gp" version="12.4.2" type="github" pages="1">
  <diagram id="5oHo156hD7aWGHc_Lqq2" name="Page-1">
    <mxGraphModel dx="1956" dy="1861" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="lhhFtVvyf6lX1trDiARA-51" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="434" y="240" width="550" height="270" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-1" target="lhhFtVvyf6lX1trDiARA-2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-1" value="StreamMap&lt;br&gt;(map)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="284" y="320" width="120" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-2" target="lhhFtVvyf6lX1trDiARA-5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-2" value="from: (fields...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="484" y="320" width="120" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-3" target="lhhFtVvyf6lX1trDiARA-4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-3" value="CustomSource" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="-36" y="320" width="120" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-4" target="lhhFtVvyf6lX1trDiARA-1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-4" value="Timestamp/Watermarks" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="114" y="320" width="140" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-5" target="lhhFtVvyf6lX1trDiARA-6">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-5" value="where:(filter functions...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="634" y="320" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-6" target="lhhFtVvyf6lX1trDiARA-7">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-6" value="time attribute: (row_time)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="814" y="320" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-7" target="lhhFtVvyf6lX1trDiARA-9">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-7" target="lhhFtVvyf6lX1trDiARA-13">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-7" target="lhhFtVvyf6lX1trDiARA-17">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-7" target="lhhFtVvyf6lX1trDiARA-21">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-7" target="lhhFtVvyf6lX1trDiARA-25">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-50" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-7" target="lhhFtVvyf6lX1trDiARA-35">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-7" value="Partition" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1020" y="320" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-8" value="" style="endArrow=none;dashed=1;html=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1190" y="654.7999877929688" as="sourcePoint"/>
            <mxPoint x="1190" y="60" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-9" value="groupBy:(...), window(...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1270" y="60" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-10" value="select: (...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1460" y="60" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-11" value="to: Row" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1640" y="60" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-12" value="sink" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1820" y="60" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-13" value="groupBy:(...), window(...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1270" y="200" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-14" value="select: (...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1460" y="200" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-15" value="to: Row" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1640" y="200" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-16" value="sink" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1820" y="200" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-17" value="groupBy:(...), window(...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1270" y="280" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-18" value="select: (...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1460" y="280" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-19" value="to: Row" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1640" y="280" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-20" value="sink" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1820" y="280" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-21" value="groupBy:(...), window(...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1270" y="360" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-22" value="select: (...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1460" y="360" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-23" value="to: Row" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1640" y="360" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-24" value="sink" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1820" y="360" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-25" value="groupBy:(...), window(...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1270" y="440" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-26" value="select: (...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1460" y="440" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-27" value="to: Row" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1640" y="440" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-28" value="sink" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1820" y="440" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-29" value="&lt;font style=&quot;font-size: 33px&quot;&gt;......&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1280" y="524" width="40" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-33" value="&lt;font style=&quot;font-size: 33px&quot;&gt;......&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1280" y="150" width="40" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-35" value="groupBy:(...), window(...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1270" y="580" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-36" value="select: (...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1460" y="580" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-37" value="to: Row" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1640" y="580" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-38" value="sink" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1820" y="580" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-55" value="CopyingBroadcastingOutputCollector&lt;br&gt;(500x)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="680" y="270" width="40" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-57" value="&lt;pre style=&quot;background-color: rgb(43 , 43 , 43) ; color: rgb(169 , 183 , 198) ; font-family: &amp;#34;consolas&amp;#34; ; font-size: 13px&quot;&gt;&lt;span style=&quot;color: #bbb529&quot;&gt;@Override&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;collect&lt;/span&gt;(StreamRecord&amp;lt;&lt;span style=&quot;color: #507874&quot;&gt;T&lt;/span&gt;&amp;gt; record) {&lt;br&gt;&lt;br&gt;   &lt;span style=&quot;color: #cc7832&quot;&gt;for &lt;/span&gt;(&lt;span style=&quot;color: #cc7832&quot;&gt;int &lt;/span&gt;i = &lt;span style=&quot;color: #6897bb&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;; &lt;/span&gt;i &amp;lt; &lt;span style=&quot;color: #9876aa&quot;&gt;outputs&lt;/span&gt;.&lt;span style=&quot;color: #9876aa&quot;&gt;length &lt;/span&gt;- &lt;span style=&quot;color: #6897bb&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;; &lt;/span&gt;i++) {&lt;br&gt;      Output&amp;lt;StreamRecord&amp;lt;&lt;span style=&quot;color: #507874&quot;&gt;T&lt;/span&gt;&amp;gt;&amp;gt; output = &lt;span style=&quot;color: #9876aa&quot;&gt;outputs&lt;/span&gt;[i]&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;      &lt;/span&gt;StreamRecord&amp;lt;&lt;span style=&quot;color: #507874&quot;&gt;T&lt;/span&gt;&amp;gt; shallowCopy = record.copy(record.getValue())&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;      &lt;/span&gt;output.collect(shallowCopy)&lt;span style=&quot;color: #cc7832&quot;&gt;;  // 这里只有浅拷贝，按理不会很影响性能&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;   &lt;/span&gt;}&lt;br&gt;&lt;br&gt;   &lt;span style=&quot;color: #cc7832&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: #9876aa&quot;&gt;outputs&lt;/span&gt;.&lt;span style=&quot;color: #9876aa&quot;&gt;length &lt;/span&gt;&amp;gt; &lt;span style=&quot;color: #6897bb&quot;&gt;0&lt;/span&gt;) {&lt;br&gt;      &lt;span style=&quot;color: #808080&quot;&gt;// don&#39;t copy for the last output&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #808080&quot;&gt;      &lt;/span&gt;&lt;span style=&quot;color: #9876aa&quot;&gt;outputs&lt;/span&gt;[&lt;span style=&quot;color: #9876aa&quot;&gt;outputs&lt;/span&gt;.&lt;span style=&quot;color: #9876aa&quot;&gt;length &lt;/span&gt;- &lt;span style=&quot;color: #6897bb&quot;&gt;1&lt;/span&gt;].collect(record)&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;   &lt;/span&gt;}&lt;br&gt;}&lt;/pre&gt;" style="html=1;whiteSpace=wrap;comic=1;strokeWidth=1;fontFamily=Comic Sans MS;fontStyle=1;dashed=1;align=left;strokeColor=none;gradientColor=none;fillColor=none;spacingTop=1;spacingBottom=1;spacingLeft=1;spacingRight=1;spacing=3;" vertex="1" parent="1">
          <mxGeometry x="420" y="-60" width="536" height="210" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-64" value="" style="curved=1;endArrow=classic;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-51" target="lhhFtVvyf6lX1trDiARA-57">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-40" y="730" as="sourcePoint"/>
            <mxPoint x="10" y="680" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="660" y="220"/>
              <mxPoint x="760" y="200"/>
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-67" value="&lt;pre style=&quot;background-color: rgb(43 , 43 , 43) ; color: rgb(169 , 183 , 198) ; font-family: &amp;#34;consolas&amp;#34; ; font-size: 13px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;consolas&amp;#34; ; font-size: 10.8pt&quot;&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;public class &lt;/span&gt;DataStreamSourceConversion$11 &lt;span style=&quot;color: #cc7832&quot;&gt;extends &lt;/span&gt;org.apache.flink.streaming.api.functions.ProcessFunction {&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color: #cc7832&quot;&gt;final &lt;/span&gt;org.apache.flink.types.Row &lt;span style=&quot;color: #9876aa&quot;&gt;out &lt;/span&gt;= &lt;span style=&quot;color: #cc7832&quot;&gt;new &lt;/span&gt;org.apache.flink.types.Row(&lt;span style=&quot;color: #6897bb&quot;&gt;5&lt;/span&gt;)&lt;span style=&quot;color: #cc7832&quot;&gt;;       这个函数可以视为数据的拷贝&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #bbb529&quot;&gt;@Override&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #bbb529&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;processElement&lt;/span&gt;(Object _in1&lt;span style=&quot;color: #cc7832&quot;&gt;, &lt;/span&gt;org.apache.flink.streaming.api.functions.ProcessFunction.Context ctx&lt;span style=&quot;color: #cc7832&quot;&gt;, &lt;/span&gt;org.apache.flink.util.Collector c) &lt;span style=&quot;color: #cc7832&quot;&gt;throws &lt;/span&gt;Exception {&lt;br&gt;        org.apache.flink.api.java.tuple.Tuple5 in1 = (org.apache.flink.api.java.tuple.Tuple5) _in1&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;        boolean &lt;/span&gt;isNull$5 = (java.lang.String) in1.&lt;span style=&quot;color: #9876aa&quot;&gt;f2 &lt;/span&gt;== &lt;span style=&quot;color: #cc7832&quot;&gt;null;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;        &lt;/span&gt;java.lang.String result$4&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;        if &lt;/span&gt;(isNull$5) {&lt;br&gt;            result$4 = &lt;span style=&quot;color: #6a8759&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;        &lt;/span&gt;} &lt;span style=&quot;color: #cc7832&quot;&gt;else &lt;/span&gt;{&lt;br&gt;            result$4 = (java.lang.String) (java.lang.String) in1.&lt;span style=&quot;color: #9876aa&quot;&gt;f2&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;        &lt;/span&gt;}&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;consolas&amp;#34; ; font-size: 10.8pt&quot;&gt;...&lt;/pre&gt;&lt;/pre&gt;" style="html=1;whiteSpace=wrap;comic=1;strokeWidth=1;fontFamily=Comic Sans MS;fontStyle=1;dashed=1;align=left;strokeColor=none;gradientColor=none;fillColor=none;spacingTop=1;spacingBottom=1;spacingLeft=1;spacingRight=1;spacing=3;" vertex="1" parent="1">
          <mxGeometry x="-190" y="600" width="1330" height="290" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-68" value="" style="curved=1;endArrow=classic;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-70" target="lhhFtVvyf6lX1trDiARA-67">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="719" y="250" as="sourcePoint"/>
            <mxPoint x="698" y="160" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="430" y="520"/>
              <mxPoint x="600" y="520"/>
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-69" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-70" target="lhhFtVvyf6lX1trDiARA-72">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-70" value="from: (fields...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="484" y="400" width="120" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-71" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-72" target="lhhFtVvyf6lX1trDiARA-74">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-72" value="where:(filter functions...)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="634" y="400" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-73" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-74" target="lhhFtVvyf6lX1trDiARA-75">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1020" y="430" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-74" value="time attribute: (row_time)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="814" y="400" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-79" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-75" target="lhhFtVvyf6lX1trDiARA-21">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-75" value="Partition" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1020" y="400" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-76" value="&lt;font style=&quot;font-size: 33px&quot;&gt;......&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="680" y="470" width="40" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-77" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.744;entryY=-0.003;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-67" target="lhhFtVvyf6lX1trDiARA-67">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-78" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-1" target="lhhFtVvyf6lX1trDiARA-70">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="413.42857142857156" y="359.5714285714289" as="sourcePoint"/>
            <mxPoint x="494" y="359.5714285714289" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="450" y="350"/>
              <mxPoint x="450" y="430"/>
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-81" value="" style="rounded=0;comic=1;strokeWidth=4;endArrow=blockThin;html=1;fontFamily=Comic Sans MS;fontStyle=1;fontColor=#FF0000;fillColor=#f8cecc;strokeColor=#CC0000;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="850" y="530" as="sourcePoint"/>
            <mxPoint x="790" y="430" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-84" value="过滤条件写在每条规则中，则数据量的reduce发生在这里" style="html=1;whiteSpace=wrap;comic=1;strokeWidth=2;fontFamily=Comic Sans MS;fontStyle=1;dashed=1;fillColor=none;gradientColor=none;" vertex="1" parent="1">
          <mxGeometry x="850" y="530" width="120" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-85" value="" style="rounded=0;comic=1;strokeWidth=4;endArrow=blockThin;html=1;fontFamily=Comic Sans MS;fontStyle=1;fontColor=#FF0000;fillColor=#f8cecc;strokeColor=#CC0000;exitX=1;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-86">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="320" y="450" as="sourcePoint"/>
            <mxPoint x="420" y="350" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-86" value="前置过滤的话，数据量的reduce发生在这里" style="html=1;whiteSpace=wrap;comic=1;strokeWidth=2;fontFamily=Comic Sans MS;fontStyle=1;dashed=1;fillColor=none;gradientColor=none;" vertex="1" parent="1">
          <mxGeometry x="230" y="470" width="120" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-89" value="" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;fillColor=none;gradientColor=none;fontColor=#FF0000;strokeColor=#FF0000;" vertex="1" parent="1">
          <mxGeometry x="-156" y="630" width="606" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-93" value="" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;fillColor=none;gradientColor=none;fontColor=#FF0000;strokeColor=#FF0000;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="470" y="390" width="330" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-94" value="导致两种场景下，出现性能差异的地方只可能是from和where翻译出来的两个processFunction，进一步说，我觉得是from中的拷贝行为导致的" style="html=1;whiteSpace=wrap;comic=1;strokeWidth=2;fontFamily=Comic Sans MS;fontStyle=1;dashed=1;fillColor=none;gradientColor=none;" vertex="1" parent="1">
          <mxGeometry x="584" y="525" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-97" value="" style="rounded=0;comic=1;strokeWidth=4;endArrow=blockThin;html=1;fontFamily=Comic Sans MS;fontStyle=1;fontColor=#FF0000;fillColor=#f8cecc;strokeColor=#CC0000;exitX=0;exitY=0;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="lhhFtVvyf6lX1trDiARA-94" target="lhhFtVvyf6lX1trDiARA-93">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="860" y="540" as="sourcePoint"/>
            <mxPoint x="590" y="480" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-98" value="CopyingBroadcastingOutputCollector中持有每一个规则编译出来的operator-chain，每当一条事件到达时，这个类会将事件对象做一次浅拷贝后，循环丢给不同的规则做处理" style="html=1;whiteSpace=wrap;comic=1;strokeWidth=2;fontFamily=Comic Sans MS;fontStyle=1;dashed=1;fillColor=none;gradientColor=none;align=left;" vertex="1" parent="1">
          <mxGeometry x="930" y="-60" width="240" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-100" value="from clause被翻译成的processFunction，它会将事件依据from字段，从原始数据格式中抽取对应字段，组成Row对象，作为TableApi的输入，这是一个等效序列化/反序列化/拷贝过程" style="html=1;whiteSpace=wrap;comic=1;strokeWidth=2;fontFamily=Comic Sans MS;fontStyle=1;dashed=1;fillColor=none;gradientColor=none;align=left;" vertex="1" parent="1">
          <mxGeometry x="-180" y="505" width="240" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="lhhFtVvyf6lX1trDiARA-103" value="这是500条Flink SQL编译成的OperatorChain，其中Partition之后的部分不用关注，因为即使where之后数据量reduce到0，性能依旧不高，这说明主要的性能开销在partition之前——即CopyingBroadcastingOutputCollector中" style="html=1;whiteSpace=wrap;comic=1;strokeWidth=2;fontFamily=Comic Sans MS;fontStyle=1;dashed=1;fillColor=none;gradientColor=none;align=left;" vertex="1" parent="1">
          <mxGeometry x="-162" y="200" width="246" height="110" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
